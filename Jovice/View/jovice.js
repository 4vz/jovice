(function () {

    var jovice;

    // jovice
    (function (window) {

        var inited = false;
        var page = null;
        var onmain = false;
        var mainonclose = function () {
        };

        var b_navigation;
        var b_top;

        var offline;

        jovice = function () { };
        jovice.init = function (p) {
            page = p;
            if (inited) return p; inited = true;

            var top = ui.topContainer();
            ui.marginTop(50 + 50);

            b_navigation = ui.box(top)({ color: 90, cursor: "text" });

            offline = ui.box(top)({ width: "100%", height: 50, color: 25, hide: true });
            var ioffline = ui.icon(offline, "powercut")({ size: 30, color: 90, position: [10, 10] });
            var toffline = ui.text(offline)({ text: "STREAM UNAVAILABLE", font: ["body", 14], color: 90, position: [50, 14], weight: "600" });

            //b_top = ui.box(top)({ left: 0, color: 98, width: "100%", height: 35 });
            //var topClock = ui.text(top)({ font: ["head", 14], color: 45, top: 8, right: 30 });
            share.timer(function () {
                //topClock.text(share.date("{HH}:{mm}"));
            });

            $$.stream(function (type, data) {
                if (type == "online") offline.hide();
                else if (type == "offline") offline.show();
            });

            (function (/*search*/) {
                var i_glass = ui.icon(b_navigation, "search")({ size: [30, 30], color: 65, position: [10, 10] });
                var i_arrow = ui.icon(b_navigation, "leftarrow")({ size: [30, 30], color: "accent", position: [10, 10], hide: true, cursor: "pointer", button: { normal: function () { i_arrow.color("accent"); }, over: function () { i_arrow.color("accent+25", { duration: 500 }); }, click: function () { deactivateSearch(); } } });
                var i_close = ui.icon(b_navigation, "cross")({ size: [25, 25], color: "accent", top: 12, right: 12, hide: true, cursor: "pointer", button: { normal: function () { i_close.color("accent"); }, over: function () { i_close.color("accent+25", { duration: 500 }); }, click: function () { v_search.value(""); } } });

                var t_start = ui.text(b_navigation)({ noSelect: true, text: "Search anything here", font: ["body", 17], color: 65, position: [50, 13] });
                var v_search = ui.textinput(b_navigation)({ font: 17, width: null, leftRight: [50, 50], top: 13, hide: true, design: false });

                function activateSearch() {
                    if ($$.once("activateSearch")) return;
                    t_start.fadeOut(50);
                    v_search.show();
                    b_navigation.color(100, { duration: 166 });

                    var dur = 166;
                    i_arrow({ rotation: [-135, 0, { duration: dur }], fadeIn: dur });
                    i_glass({ rotation: [0, 135, { duration: dur }], fadeOut: dur });
                };
                function deactivateSearch() {
                    $$.removeOnce("activateSearch");
                    t_start.fadeIn(50);
                    v_search.hide();
                    v_search.value("");

                    if (onmain)
                        b_navigation.color(null, { duration: 166 });
                    else
                        b_navigation.color(90, { duration: 166 });

                    var dur = 166;
                    i_arrow({ rotation: [0, -135, { duration: dur }], fadeOut: dur });
                    i_glass({ rotation: [135, 0, { duration: dur }], fadeIn: dur });
                    if (i_close.isShown()) i_close({ rotation: [0, 45, { duration: dur }], fadeOut: dur });
                };
                function beginSearch() {
                    var s = v_search.value();

                    if (s != "") {
                        s = s.replace(/ +(?= )/g, '');
                        s = s.replaceAll(' ', '+');
                        s = escape(s);
                        page.transfer("/search/" + s);
                    }
                };
                function showClose() {
                    var dur = 166;
                    if (!i_close.isShown()) i_close({ rotation: [-135, 0, { duration: dur }], fadeIn: dur });
                };

                jovice.setSearchBoxValue = function (s) {
                    if (s == null) {
                        if (i_arrow.isShown())
                            deactivateSearch();
                        return;
                    }
                    if (!i_arrow.isShown()) activateSearch();
                    v_search.value(s);

                    if (s != null) {
                        onmain = false;
                       
                        b_navigation({
                            leftRight: [0, 0], height: 50, top: 50, left: 0, border: null
                        });

                        mainonclose();
                    }

                    showClose();
                };

                b_navigation.down(function (b) {
                    activateSearch();
                    v_search.focus();
                });
                v_search.focusout(function () {
                    if (v_search.value().trim() == "")
                        deactivateSearch();
                });
                v_search.keydown(function (c) {
                    if (c.key == 13) beginSearch();
                    //$$(10, function () {
                    //console.debug(c);

                    var keycode = c.key;

                    var valid =
                        (keycode > 47 && keycode < 58) || // number keys
                        keycode == 32 || keycode == 13 || // spacebar & return key(s) (if you want to allow carriage returns)
                        (keycode > 64 && keycode < 91) || // letter keys
                        (keycode > 95 && keycode < 112) || // numpad keys
                        (keycode > 185 && keycode < 193) || // ;=,-./` (in order)
                        (keycode > 218 && keycode < 223);   // [\]' (in order)

                    if (valid   //v_search.value().trim() != ""
                        ) {
                            if (onmain) {
                                onmain = false;
                                b_navigation({
                                    size: ["100%", 50], top: 50, left: 0, border: null
                                });
                                mainonclose();
                            }

                            showClose();
                        }
                    //});
                });

            })();

            
            // -- COLLABORATION
            (function () {

                //ui.marginRight(50);

                //function sidebarActivate() {



                //    ui.marginRight(500, { duration: 300 });
                //};





                //$$(2000, function () {
                //    sidebarActivate();
                //});
                
            })();






            return p;
        };
        jovice.main = function (onclose) {

            mainonclose = onclose;
            onmain = true;
            var originalMarginTop = ui.marginTop();
            var originalMarginLeft = ui.marginLeft();
            var originalMarginRight = ui.marginRight();
            var originalMarginBottom = ui.marginBottom();

            var pwidth = page.width();
            var pheight = page.height();

            if (pwidth < 840) {
                b_navigation({
                    size: [null, 50],
                    leftRight: [20, 20],
                });
            }
            else {
                b_navigation({
                    size: [800, 50],
                    left: (pwidth - 800 + originalMarginLeft) / 2,
                });
            }

            b_navigation({                
                color: null,                
                top: 215 + 50,
                border: { size: 1, color: 80 }
            });

        };
        jovice.icon = function (name) {
            if (name == "topology") return "M305.188,65.777c-15.874,0-28.789,12.915-28.789,28.789c0,5.521,1.565,10.682,4.271,15.068l-59.435,70.333	c-3.445-1.46-7.23-2.269-11.201-2.269c-6.512,0-12.522,2.176-17.352,5.835l-50.122-36.198c0.716-2.507,1.106-5.15,1.106-7.884 c0-15.873-12.915-28.786-28.789-28.786c-15.875,0-28.789,12.914-28.789,28.786c0,5.319,1.456,10.303,3.981,14.583L40.535,213.14c-3.591-1.611-7.564-2.516-11.748-2.516C12.914,210.624,0,223.538,0,239.41c0,15.874,12.914,28.789,28.787,28.789c15.874,0,28.789-12.914,28.789-28.789c0-5.136-1.358-9.958-3.726-14.137l49.733-59.343c3.47,1.485,7.287,2.31,11.293,2.31c6.61,0,12.703-2.246,17.568-6.006l49.982,36.096c-0.766,2.588-1.184,5.323-1.184,8.156c0,15.873,12.915,28.787,28.789,28.787c15.873,0,28.787-12.914,28.787-28.787c0-5.355-1.475-10.372-4.032-14.671l59.63-70.562c3.329,1.348,6.963,2.098,10.77,2.098c15.874,0,28.789-12.914,28.789-28.786C333.977,78.692,321.061,65.777,305.188,65.777z";
            else if (name == "speed") return "M52.173,57.876c-0.028-0.329-0.122-0.658-0.286-0.971L31.254,17.971c-0.609-1.144-1.983-1.684-3.229-1.267    c-1.248,0.423-1.993,1.674-1.756,2.95l8.041,43.173c0.063,0.343,0.196,0.65,0.377,0.93c0.078,0.369,0.173,0.736,0.3,1.104    c1.295,3.694,4.838,6.184,8.813,6.184c1.027,0,2.048-0.166,3.024-0.497c2.354-0.792,4.253-2.438,5.347-4.636    c1.095-2.198,1.251-4.68,0.444-6.994C52.492,58.555,52.34,58.21,52.173,57.876z M43.803,19.533c-1.471,0-2.662,1.17-2.662,2.613    c0,1.443,1.191,2.614,2.662,2.614c21.218,0,38.476,16.961,38.476,37.806c0,1.442,1.195,2.613,2.664,2.613    c1.473,0,2.664-1.171,2.664-2.613C87.605,38.834,67.956,19.533,43.803,19.533z M16.276,29.087C5.933,37.306,0,49.507,0,62.565    c0,1.443,1.191,2.615,2.663,2.615c1.474,0,2.665-1.172,2.665-2.615c0-11.47,5.211-22.189,14.298-29.409    c1.146-0.908,1.32-2.556,0.397-3.679C19.1,28.355,17.423,28.179,16.276,29.087z";
            else if (name == "cloud") return "M320,128c52.562,0,95.375,42.438,96,94.813c-0.25,1.938-0.438,3.875-0.5,5.875l-0.812,23.5l22.25,7.75    C462.688,268.906,480,293.062,480,320c0,35.312-28.688,64-64,64H96c-35.281,0-64-28.688-64-64c0-34.938,28.188-63.438,63-64    c1.5,0.219,3.063,0.406,4.625,0.5l24.313,1.594l8-22.969C140.938,209.313,165.063,192,192,192c3.125,0,6.563,0.375,11.188,1.188    l22.406,4.031l11.156-19.844C253.875,146.938,285.75,128,320,128 M320,96c-47.938,0-89.219,26.688-111.156,65.688    C203.375,160.719,197.781,160,192,160c-41.938,0-77.219,27.063-90.281,64.563C99.813,224.438,97.969,224,96,224c-53,0-96,43-96,96    s43,96,96,96h320c53,0,96-43,96-96c0-41.938-27.062-77.25-64.562-90.313C447.5,227.75,448,225.938,448,224    C448,153.313,390.688,96,320,96L320,96z";
            else if (name == "IP") return "M6.776,4.72h1.549v6.827H6.776V4.72z M11.751,4.669c-0.942,0-1.61,0.061-2.087,0.143v6.735h1.53    V9.106c0.143,0.02,0.324,0.031,0.527,0.031c0.911,0,1.691-0.224,2.218-0.721c0.405-0.386,0.628-0.952,0.628-1.621    c0-0.668-0.295-1.234-0.729-1.579C13.382,4.851,12.702,4.669,11.751,4.669z M11.709,7.95c-0.222,0-0.385-0.01-0.516-0.041V5.895    c0.111-0.03,0.324-0.061,0.639-0.061c0.769,0,1.205,0.375,1.205,1.002C13.037,7.535,12.53,7.95,11.709,7.95z M10.117,0    C5.523,0,1.8,3.723,1.8,8.316s8.317,11.918,8.317,11.918s8.317-7.324,8.317-11.917S14.711,0,10.117,0z M10.138,13.373    c-3.05,0-5.522-2.473-5.522-5.524c0-3.05,2.473-5.522,5.522-5.522c3.051,0,5.522,2.473,5.522,5.522    C15.66,10.899,13.188,13.373,10.138,13.373z";
            else if (name == "split") return "M255,0L313.65 58.65 239.7 132.6 275.4 168.3 349.35 94.35 408 153 408 0 z M153,0L0 0 0 153 58.65 94.35 178.5 214.2 178.5 408 229.5 408 229.5 193.8 94.35 58.65 z";
            else if (name == "upload") return "M174.804,349.607L301.934 349.607 301.266 158.912 397.281 158.912 238.369 0 79.456 158.912 174.804 158.912 z  M365.499,349.607L365.499 413.172 111.239 413.172 111.239 349.607 47.674 349.607 47.674 476.737 429.063 476.737 429.063 349.607 z";
            else if (name == "download") return "M227.996,334.394L379.993 182.397 288.795 182.397 288.795 0 167.197 0 167.744 182.397 75.999 182.397 z  M349.594,334.394L349.594 395.193 106.398 395.193 106.398 334.394 45.599 334.394 45.599 395.193 45.599 455.992 410.393 455.992 410.393 334.394 z";
            else if (name == "boxin") return "M349.138,19.909L329.195 0 189.656 139.531 189.656 62.663 161.481 62.663 161.481 187.65 286.43 187.65 286.453 159.46 209.574 159.46 zM321.749,161.568L321.749 321.755 29.28 321.755 29.28 29.273 187.464 29.273 187.464 0 0.006 0 0.006 351.028 351.022 351.028 351.022 161.568 z";
            else if (name == "boxout") return "M215.013,223.333L241.569 249.84 427.364 64.053 427.364 166.4 464.869 166.4 464.869 0 298.51 0 298.477 37.522 400.848 37.522 z M428.412,215.131L428.412 428.417 38.989 428.417 38.989 38.977 249.608 38.977 249.608 0 0.004 0 0.004 467.393 467.389 467.393 467.389 215.131 z";
            else if (name == "boxsel") return "M0,162.3L24.419 162.3 24.419 29.687 156.539 29.687 156.539 5.269 0 5.269 z M187.302,5.509L187.302 29.927 319.924 29.927 319.924 162.042 344.339 162.042 344.339 5.509 zM24.419,182.038L0 182.038 0 339.07 156.539 339.07 156.539 314.648 24.419 314.648 zM319.924,314.408L187.302 314.408 187.302 338.83 344.339 338.83 344.339 182.291 319.924 182.291 z";
            else if (name == "excl") return "M244.709,389.496c18.736,0,34.332-14.355,35.91-33.026l24.359-290.927c1.418-16.873-4.303-33.553-15.756-46.011      C277.783,7.09,261.629,0,244.709,0s-33.074,7.09-44.514,19.532C188.74,31.99,183.022,48.67,184.44,65.543l24.359,290.927  C210.377,375.141,225.973,389.496,244.709,389.496z M244.709,410.908c-21.684,0-39.256,17.571-39.256,39.256c0,21.683,17.572,39.254,39.256,39.254 s39.256-17.571,39.256-39.254C283.965,428.479,266.393,410.908,244.709,410.908z";
            else if (name == "gear") return "M113.595,133.642l-5.932-13.169c5.655-4.151,10.512-9.315,14.307-15.209l13.507,5.118c2.583,0.979,5.469-0.322,6.447-2.904    l4.964-13.103c0.47-1.24,0.428-2.616-0.117-3.825c-0.545-1.209-1.547-2.152-2.788-2.622l-13.507-5.118      c1.064-6.93,0.848-14.014-0.637-20.871l13.169-5.932c1.209-0.545,2.152-1.547,2.622-2.788c0.47-1.24,0.428-2.616-0.117-3.825       l-5.755-12.775c-1.134-2.518-4.096-3.638-6.612-2.505l-13.169,5.932c-4.151-5.655-9.315-10.512-15.209-14.307l5.118-13.507      c0.978-2.582-0.322-5.469-2.904-6.447L93.88,0.82c-1.239-0.469-2.615-0.428-3.825,0.117c-1.209,0.545-2.152,1.547-2.622,2.788   l-5.117,13.506c-6.937-1.07-14.033-0.849-20.872,0.636L55.513,4.699c-0.545-1.209-1.547-2.152-2.788-2.622   c-1.239-0.469-2.616-0.428-3.825,0.117L36.124,7.949c-2.518,1.134-3.639,4.094-2.505,6.612l5.932,13.169   c-5.655,4.151-10.512,9.315-14.307,15.209l-13.507-5.118c-1.239-0.469-2.615-0.427-3.825,0.117    c-1.209,0.545-2.152,1.547-2.622,2.788L0.326,53.828c-0.978,2.582,0.322,5.469,2.904,6.447l13.507,5.118   c-1.064,6.929-0.848,14.015,0.637,20.871L4.204,92.196c-1.209,0.545-2.152,1.547-2.622,2.788c-0.47,1.24-0.428,2.616,0.117,3.825  l5.755,12.775c0.544,1.209,1.547,2.152,2.787,2.622c1.241,0.47,2.616,0.429,3.825-0.117l13.169-5.932   c4.151,5.656,9.314,10.512,15.209,14.307l-5.118,13.507c-0.978,2.582,0.322,5.469,2.904,6.447l13.103,4.964  c0.571,0.216,1.172,0.324,1.771,0.324c0.701,0,1.402-0.147,2.054-0.441c1.209-0.545,2.152-1.547,2.622-2.788l5.117-13.506  c6.937,1.069,14.034,0.849,20.872-0.636l5.931,13.168c0.545,1.209,1.547,2.152,2.788,2.622c1.24,0.47,2.617,0.429,3.825-0.117  l12.775-5.754C113.607,139.12,114.729,136.16,113.595,133.642z M105.309,86.113c-4.963,13.1-17.706,21.901-31.709,21.901 c-4.096,0-8.135-0.744-12.005-2.21c-8.468-3.208-15.18-9.522-18.899-17.779c-3.719-8.256-4-17.467-0.792-25.935  c4.963-13.1,17.706-21.901,31.709-21.901c4.096,0,8.135,0.744,12.005,2.21c8.468,3.208,15.18,9.522,18.899,17.778  C108.237,68.434,108.518,77.645,105.309,86.113z M216.478,154.389c-0.896-0.977-2.145-1.558-3.469-1.615l-9.418-0.404  c-0.867-4.445-2.433-8.736-4.633-12.697l6.945-6.374c2.035-1.867,2.17-5.03,0.303-7.064l-6.896-7.514  c-0.896-0.977-2.145-1.558-3.47-1.615c-1.322-0.049-2.618,0.416-3.595,1.312l-6.944,6.374c-3.759-2.531-7.9-4.458-12.254-5.702  l0.404-9.418c0.118-2.759-2.023-5.091-4.782-5.209l-10.189-0.437c-2.745-0.104-5.091,2.023-5.209,4.781l-0.404,9.418   c-4.444,0.867-8.735,2.433-12.697,4.632l-6.374-6.945c-0.896-0.977-2.145-1.558-3.469-1.615c-1.324-0.054-2.618,0.416-3.595,1.312  l-7.514,6.896c-2.035,1.867-2.17,5.03-0.303,7.064l6.374,6.945c-2.531,3.759-4.458,7.899-5.702,12.254l-9.417-0.404    c-2.747-0.111-5.092,2.022-5.21,4.781l-0.437,10.189c-0.057,1.325,0.415,2.618,1.312,3.595c0.896,0.977,2.145,1.558,3.47,1.615  l9.417,0.403c0.867,4.445,2.433,8.736,4.632,12.698l-6.944,6.374c-0.977,0.896-1.558,2.145-1.615,3.469  c-0.057,1.325,0.415,2.618,1.312,3.595l6.896,7.514c0.896,0.977,2.145,1.558,3.47,1.615c1.319,0.053,2.618-0.416,3.595-1.312  l6.944-6.374c3.759,2.531,7.9,4.458,12.254,5.702l-0.404,9.418c-0.118,2.759,2.022,5.091,4.781,5.209l10.189,0.437  c0.072,0.003,0.143,0.004,0.214,0.004c1.25,0,2.457-0.468,3.381-1.316c0.977-0.896,1.558-2.145,1.615-3.469l0.404-9.418  c4.444-0.867,8.735-2.433,12.697-4.632l6.374,6.945c0.896,0.977,2.145,1.558,3.469,1.615c1.33,0.058,2.619-0.416,3.595-1.312  l7.514-6.896c2.035-1.867,2.17-5.03,0.303-7.064l-6.374-6.945c2.531-3.759,4.458-7.899,5.702-12.254l9.417,0.404  c2.756,0.106,5.091-2.022,5.21-4.781l0.437-10.189C217.847,156.659,217.375,155.366,216.478,154.389z M160.157,183.953 c-12.844-0.55-22.846-11.448-22.295-24.292c0.536-12.514,10.759-22.317,23.273-22.317c0.338,0,0.678,0.007,1.019,0.022 c12.844,0.551,22.846,11.448,22.295,24.292C183.898,174.511,173.106,184.497,160.157,183.953z";
            else if (name == "placeholder") return "M516.316,337.52l94.233,193.581c3.832,7.873-0.196,14.314-8.952,14.314H10.402c-8.756,0-12.785-6.441-8.952-14.314 L95.684,337.52c1.499-3.079,5.528-5.599,8.952-5.599h80.801c2.49,0,5.853,1.559,7.483,3.442     c5.482,6.335,11.066,12.524,16.634,18.65c5.288,5.815,10.604,11.706,15.878,17.735h-95.891c-3.425,0-7.454,2.519-8.952,5.599   L58.163,505.589h495.67l-62.421-128.242c-1.498-3.08-5.527-5.599-8.953-5.599h-96.108c5.273-6.029,10.591-11.92,15.879-17.735   c5.585-6.144,11.2-12.321,16.695-18.658c1.628-1.878,4.984-3.434,7.47-3.434h80.971  C510.789,331.921,514.817,334.439,516.316,337.52z M444.541,205.228c0,105.776-88.058,125.614-129.472,227.265  c-3.365,8.26-14.994,8.218-18.36-0.04c-37.359-91.651-112.638-116.784-127.041-198.432  c-14.181-80.379,41.471-159.115,122.729-166.796C375.037,59.413,444.541,124.204,444.541,205.228z M379.114,205.228  c0-40.436-32.779-73.216-73.216-73.216s-73.216,32.78-73.216,73.216c0,40.437,32.779,73.216,73.216,73.216  S379.114,245.665,379.114,205.228z";
            else if (name == "route") return "M303.658,141.433L350.261 214.575 387.626 0 173.043 37.357 246.184 83.962 104.768 225.371 246.78 367.377 179.243 434.921 236.731 492.394 361.74 367.377 219.726 225.371z";
            else if (name == "warning") return "M15.789,13.982l-6.938-13C8.678,0.657,8.339,0.453,7.97,0.453H7.969c-0.369,0-0.707,0.203-0.881,0.528l-6.969,13c-0.166,0.312-0.157,0.686,0.023,0.986C0.323,15.268,0.649,15.453,1,15.453h13.906c0.352,0,0.677-0.184,0.858-0.486C15.945,14.666,15.954,14.292,15.789,13.982z M7.969,13.453c-0.552,0-1-0.448-1-1s0.448-1,1-1c0.551,0,1,0.448,1,1S8.521,13.453,7.969,13.453z M8.97,9.469c0,0.553-0.449,1-1,1c-0.552,0-1-0.447-1-1v-4c0-0.552,0.448-1,1-1 c0.551,0,1,0.448,1,1V9.469z";
        };
        jovice.formatInterfaceName = function (name, man) {
            if (man == "ALCATEL-LUCENT") {
                if (name.startsWith("Ex")) {
                    name = name.substr(2);
                }
                else if (name.startsWith("Ag")) {
                    name = "lag-" + name.substr(2);
                }

                if (name.endsWith(".DIRECT")) {
                    name = name.substr(0, name.indexOf(".DIRECT"));
                }

                if (name.endsWith(".1") || name.indexOf(".1.") > -1) {

                }
                else {
                    var firstdot = name.indexOf(".");
                    if (firstdot > -1) {
                        name = name.substr(0, firstdot) + ":" + name.substr(firstdot + 1);
                    }
                }
            }
            else if (man == "HUAWEI") {
                if (name.startsWith("Ag")) {
                    name = "Eth-Trunk" + name.substr(2);
                }
            }

            return name;
        };
        
        $$.resize(function (r) {
            if (r.width == null) return;
            if (onmain) {
                if (r.width < 840) {
                    b_navigation({
                        width: "",
                        leftRight: [20, 20]
                    });
                }
                else {
                    b_navigation({
                        width: 800,
                        left: (r.width - 800) / 2,
                    });
                }

                if (true) {
                    b_navigation({
                        top: 265,
                    });
                }
            }
        });

        window.jovice = jovice;
        window.onerror = function (e) {
            
        };

    })(window);

    // .formatBytes
    (function (jovice){

        var formatBytes = function (bytes, decimals) {
            if (bytes == 0) return '0 Byte';
            var k = 1024;
            var dm = decimals + 1 || 3;
            var sizes = ['B', 'KB', 'MB', 'GB', 'TB', 'PB', 'EB', 'ZB', 'YB'];
            var i = Math.floor(Math.log(bytes) / Math.log(k));
            return [(bytes / Math.pow(k, i)).toPrecision(dm), sizes[i]];
        };

        jovice.formatBytes = formatBytes;

    })(jovice);
})();